"use strict";class Som{constructor(t,e={dv:void 0,deepcopy:!0,stack:!1,context:void 0}){function i(){let t=new WeakSet;return(e,i)=>{if("object"==typeof i&&null!==i){if(t.has(i))return;t.add(i)}return i}}if(this.data={},this.version="1.0.2",this.deepcopy=void 0==e.deepcopy||e.deepcopy,this.defaultvalue="string"==typeof arguments[1]?arguments[1]:e.dv,e.stack&&(this.stack=[],this.options={context:e.context}),"object"==typeof t&&t instanceof Som==!1){if(Array.isArray(t)&&t.length>0){let s=this.data;if("object"==typeof t[0]){let o=this;t.forEach(function(t){if(o.deepcopy)try{s=Object.assign(s,t)}catch(e){console.warn("issue assigning object, trying removing circular references."),s=Object.assign(s,t,i())}else s=Object.assign(s,t)})}else this.deepcopy?this.data=Object.assign({},t):this.data=t}else try{this.deepcopy&&!1!=arguments[2]?this.data=Object.assign({},t):this.data=t}catch(n){console.warn("issue assigning object, trying removing circular references."),this.data=Object.assign({},t,i())}}else if("object"==typeof t&&t instanceof Som==!0)try{this.deepcopy?this.data=Object.assign({},t.data):this.data=t.data}catch(a){console.warn("issue assigning object, trying removing circular references."),this.data=Object.assign({},t.data,i())}}get(t,e,i={origin:void 0,arraycheck:!1}){let s=i.origin,o=i.arraycheck;if(void 0===t||""==t){if(this.stack&&Array.isArray(this.stack)&&"internal"!=s){let n={method:"get",path:t};void 0!=this.options.context&&(n.context="function"==typeof this.options.context?this.options.context({method:"get",value:this.data}):this.options.context),this.stack.push(n)}return this.data}let a=[];Array.isArray(t)?a=t:a.push(t);let h={};for(let f of a)h[f]={pathSplit:"",value:void 0};for(let r of a)if("string"==typeof r){h[r].pathSplit=r.split(".");let c=this.data,l=r.split(".");for(var p=0;p<l.length&&void 0!=c;p++)if(c instanceof Set){let d=c;!1==(c=!!c.has(l[p]))&&parseInt(l[p])&&(c=!!d.has(parseInt(l[p])))}else if(Array.isArray(c[l[p]])&&p==l.length-2&&o){let u=c[l[p]];!1==(c=!!c[l[p]].includes(l[p+1]))&&parseInt(l[p+1])&&(c=!!u.includes(parseInt(l[p+1])));break}else c=Array.isArray(c)&&Math.abs(parseInt(l[p]))<=c.length?0>parseInt(l[p])?c[c.length-Math.abs(parseInt(l[p]))]:c[parseInt(l[p])]:Array.isArray(c)&&Math.abs(parseInt(l[p]))>c.length?e||this.defaultvalue||void 0:c[l[p]];(""===c||void 0===c&&""==e)&&(h[r].value=""),h[r].value=c}let y="";for(let g in h)y=y||h[g].value;if(void 0===y&&""==e||""===y||!1===y){if(this.stack&&Array.isArray(this.stack)&&"internal"!=s){let v={method:"get",path:t};void 0!=this.options.context&&(v.context="function"==typeof this.options.context?this.options.context({method:"get",value:""}):this.options.context),this.stack.push(v)}return!1===y?y:""}{let $=y||e||this.defaultvalue||void 0;if(this.stack&&Array.isArray(this.stack)&&"internal"!=s){let x={method:"get",path:t};void 0!=this.options.context&&(x.context="function"==typeof this.options.context?this.options.context({method:"get",value:$}):this.options.context),this.stack.push(x)}return $}}assign(t,e,i,s={origin:void 0,type:Object,override:void 0}){let o="object"==typeof s?s.origin:s,n="object"==typeof s?s.override:"override"==s,a="object"==typeof s?s.type:Object;if(this.stack&&Array.isArray(this.stack)&&"internal"!=o&&"override"!=o){let h={method:"assign",path:t};h.method,void 0!=this.options.context&&(h.context="function"==typeof this.options.context?this.options.context({method:"assign",value:e}):this.options.context),this.stack.push(h)}if(void 0===e&&(e=i||this.defaultvalue),void 0!==t&&""!=t&&"string"==typeof t){for(var f=t.split("."),r=this.data,c=0;c<f.length&&void 0!=r;c++)if("["!=f[c][0]&&"]"!=f[c][f[c].length-1]){if(Object(r).hasOwnProperty(f[c])){if(c==f.length-1){if(r[f[c]]instanceof Set){if(n){if(a==Set){if(r[f[c]]=new Set,e instanceof Set||e instanceof Array)for(let l of e)r[f[c]].add(l);else r[f[c]].add(e)}else if(a==Array){if(r[f[c]]=[],e instanceof Set||e instanceof Array)for(let p of e)r[f[c]].push(p);else r[f[c]].push(e)}else if(r[f[c]]=new Set,e instanceof Set||e instanceof Array)for(let d of e)r[f[c]].add(d);else r[f[c]].add(e)}else if(a==Array){let u=Array.from(r[f[c]]);if(e instanceof Set||e instanceof Array)for(let y of e)u.push(y);else u.push(e);r[f[c]]=u}else if(a==Object&&!e instanceof Set&&!e instanceof Array)r[f[c]]=e;else if(e instanceof Set||e instanceof Array)for(let g of e)r[f[c]].add(g);else r[f[c]].add(e)}else if(r[f[c]]instanceof Array){if(n){if(a==Set){if(r[f[c]]=new Set,e instanceof Set||e instanceof Array)for(let v of e)r[f[c]].add(v);else r[f[c]].add(e)}else if(a==Array){if(r[f[c]]=[],e instanceof Set||e instanceof Array)for(let $ of e)r[f[c]].push($);else r[f[c]].push(e)}else if(r[f[c]]=[],e instanceof Set||e instanceof Array)for(let x of e)r[f[c]].push(x);else r[f[c]].push(e)}else if(a==Set){if(r[f[c]]=new Set(r[f[c]]),e instanceof Set||e instanceof Array)for(let m of e)r[f[c]].add(m);else r[f[c]].add(e)}else if(a==Object&&!e instanceof Set&&!e instanceof Array)r[f[c]]=e;else if(e instanceof Set||e instanceof Array)for(let b of e)r[f[c]].push(b);else r[f[c]].push(e)}else if(n){if(a==Set){if(r[f[c]]=new Set,e instanceof Array||e instanceof Set)for(let k of e)r[f[c]].add(k);else r[f[c]].add(e)}else if(a==Array){if(r[f[c]]=[],e instanceof Array||e instanceof Set)for(let _ of e)r[f[c]].push(_);else r[f[c]].push(e)}else r[f[c]]=e}else if(a==Set){if(r[f[c]]=new Set([r[f[c]]]),e instanceof Array||e instanceof Set)for(let A of e)r[f[c]].add(A);else r[f[c]].add(e)}else if(a==Array){if(r[f[c]]=Array(r[f[c]]),e instanceof Array||e instanceof Set)for(let j of e)r[f[c]].push(j);else r[f[c]].push(e)}else r[f[c]]=e}else("string"==typeof r[f[c]]||void 0===r[f[c]]||"number"==typeof r[f[c]])&&(r[f[c]]={}),r=r[f[c]]}else if(c==f.length-1){if("object"!=typeof r)return;a==Set?r[f[c]]=new Set([e]):a==Array?r[f[c]]=Array(e):r[f[c]]=e}else"["!=f[c+1][0]&&"]"!=f[c][f[c+1].length-1]?r[f[c]]={}:r[f[c]]=[],r=r[f[c]]}else if("["==f[c][0]&&"]"==f[c][f[c].length-1]){let S=f[c].slice(1,f[c].length-1);Array.isArray(r)&&Math.abs(S)<r.length?c==f.length-1?r[S]=e:r=r[S]:Array.isArray(r)&&S>=r.length&&(c==f.length-1?r.push(e):(r.push({}),r=r[r.length-1]))}}else"object"==typeof t&&(this.data=Object.assign(this.data,t));return this.data}merge(t,e){if("object"==typeof t&&void 0===e)e=t,t=void 0;else if("string"==typeof t&&"object"==typeof e);else if("object"==typeof t&&"string"==typeof e){let i=t;t=e,e=i}if(this.stack&&Array.isArray(this.stack)){let s={method:"merge",path:t};void 0!=this.options.context&&(s.context="function"==typeof this.options.context?this.options.context({method:"merge",value:e}):this.options.context),this.stack.push(s)}if(void 0===t||""==t)return this.data=Object.assign(this.data,e),this.data;{let o=t.split("."),n=this.data;for(var a=0;a<o.length&&void 0!=n;a++)n=Array.isArray(n)&&Math.abs(parseInt(o[a]))<=n.length?0>parseInt(o[a])?n[n.length-Math.abs(parseInt(o[a]))]:n[parseInt(o[a])]:Array.isArray(n)&&Math.abs(parseInt(o[a]))>n.length?this.defaultvalue||void 0:n[o[a]];if(void 0===n&&n==this.defaultvalue)return this.assign(t,e,void 0,{origin:"internal"}),this.data;if(n instanceof Set&&(e instanceof Array||e instanceof Set))e.forEach(function(t){n.add(t)});else if(Array.isArray(n)&&Array.isArray(e))e.forEach(function(t){n.push(t)});else if(Array.isArray(n))n.push(e);else{var h=Object.assign(n,e);this.data=this.assign(t,h,void 0,{origin:"internal"})}return this.data}}remove(t,e){if(this.stack&&Array.isArray(this.stack)&&"internal"!=origin){let i={method:"remove",path:t};void 0!=this.options.context&&(i.context="function"==typeof this.options.context?this.options.context({method:"remove",value:void 0}):this.options.context),this.stack.push(i)}if(void 0===e&&(e=!1),""==t||void 0===t)this.clear();else for(var s=t.split("."),o=this.data,n=0;n<s.length&&void 0!=o;n++)if("string"==typeof s[n]&&!0==isNaN(s[n])){if(!Object(o).hasOwnProperty(s[n]))return this.data;if(n==s.length-2){if(o[s[n]]instanceof Set)o[s[n]].delete(s[n+1]);else if(o[s[n]]instanceof Array){let a=o[s[n]].indexOf(s[n+1]);-1!=a&&o[s[n]].splice(a,1)}}n==s.length-1?"object"==typeof o[s[n]]?delete o[s[n]]:e?delete o[s[n]]:o[s[n]]=void 0:o=o[s[n]]}else if("string"==typeof s[n]&&!1==isNaN(s[n])){if(!(Array.isArray(o)&&Math.abs(s[n])<o.length))return this.data;if(n==s.length-1)return o.splice(s[n],1),this.data;o=o[s[n]]}}push(t,e,i=!1){if(this.stack&&Array.isArray(this.stack)&&"internal"!=origin){let s={method:"push",path:t};void 0!=this.options.context&&(s.context="function"==typeof this.options.context?this.options.context({method:"push",value:e}):this.options.context),this.stack.push(s)}if(""==t||void 0===t)this.data=[this.data],this.data.push(e);else if(t.length>0){let o=this.get(t);void 0===o||i?this.assign(t,[e],void 0,{override:!0}):o instanceof Set?o.add(e):Array.isArray(o)?o.push(e):("object"==typeof o||"string"==typeof o)&&!1==i&&this.assign(t,[o,e],void 0,{origin:"internal"})}return this.data}mergeDeep(t,e,i,s){if("string"==typeof t?(e=Array.isArray(e)?Array.from(e):Object.assign({},e),void 0===(i=i||this.get(t,void 0,{origin:"internal"}))&&(this.assign(t,{}),i=this.get(t,void 0,{origin:"internal"}))):"object"==typeof t&&(i=e||this.data,e=Array.isArray(e)?Array.from(t):Object.assign({},t)),"object"!=typeof e)throw Error("expect an object as input");let o=i||this.data;if(this.stack&&Array.isArray(this.stack)&&"internal"!=s){let n={method:"mergeDeep",path:t};void 0!=this.options.context&&(n.context="function"==typeof this.options.context?this.options.context({method:"mergeDeep",value:e}):this.options.context),this.stack.push(n)}if(Array.isArray(e)){if(Array.isArray(e)&&Array.isArray(o))for(let a in e)"object"!=typeof e[a]?o.push(e[a]):"object"==typeof e[a]&&this.mergeDeep(e[a],o[a],o[a],"internal")}else for(let h in e)if("object"!=typeof e[h])o[h]=e[h];else if("object"==typeof e[h]){if("object"!=typeof o[h])o[h]=e[h];else if(!1===Array.isArray(e[h])&&!1===Array.isArray(o[h]))this.mergeDeep(e[h],o[h],o[h],"internal");else if(Array.isArray(e[h])&&Array.isArray(o[h]))for(let f=0;f<Math.max(e[h].length,o[h].length);f++)void 0===e[h][f]||(void 0===o[h][f]?o[h][f]=e[h][f]:"object"!=typeof e[h][f]?-1==o[h].indexOf(e[h][f])&&o[h].push(e[h][f]):this.mergeDeep(e[h][f],o[h][f],o[h][f],"internal"));else Array.isArray(e[h])&&!Array.isArray(o[h])?o[h]=e[h]:!Array.isArray(e[h])&&Array.isArray(o[h])&&o[h].push(e[h])}}replace(t,e,i=!1,s,o){if(this.stack&&Array.isArray(this.stack)&&"internal"!=o){let n={method:"replace"};void 0!=this.options.context&&(n.context="function"==typeof this.options.context?this.options.context({method:"replace",value:t,new_value:e}):this.options.context),this.stack.push(n)}let a=s||this.data,h;if(i&&(h=RegExp(t)),"object"==typeof a){for(let f in a)if("object"!=typeof a[f])i?h.test(a[f])&&(a[f]=e):a[f]==t&&(a[f]=e);else if("object"==typeof a[f]){if(Array.isArray(a[f])){let r=this,c=!1;a[f].length>0&&(c="string"==typeof a[f][0]||"number"==typeof a[f][0]);let l=a[f].indexOf(t);if(-1!=l&&(a[f][l]=e),i&&c)for(l=0;l<a[f].length;l++)h.test(a[f][l])&&(a[f][l]=e);else a[f].forEach(function(s){"object"==typeof s&&r.replace(t,e,i,s,"internal")})}else if(a[f]instanceof Set)for(let p of a[f])i?h.test(p)&&(a[f].delete(p),a[f].add(e)):p==t&&(a[f].delete(t),a[f].add(e));else{if(void 0==a[f]||void 0===a[f]||a[f]instanceof Som)break;this.replace(t,e,i,a[f],"internal")}}}}searchValue(t,e=!1,i,s,o,n){let a=i||this.data,h=void 0==o?"":o,f=void 0==s?[]:s,r;if(e&&(r=RegExp(t)),"object"==typeof a){for(let c in a)if("object"!=typeof a[c]){if(e){if(r.test(a[c])){let l=""==h?c:h+"."+c;f.push(l)}}else if(a[c]==t){let p=""==h?c:h+"."+c;f.push(p)}}else if(a[c]instanceof Set){if(e){for(let d of a[c])if(r.test(d)){let u=""==h?c:h+"."+c+"."+d;f.push(u)}}else for(let y of a[c])if(y==t){let g=""==h?c:h+"."+c+"."+y;f.push(g)}}else if(Array.isArray(a[c])){let v=!1;if(a[c].length>0&&(v="string"==typeof a[c][0]||"number"==typeof a[c][0]),v){for(let $=0;$<a[c].length;$++)if(e){if(r.test(a[c][$])){let x=""==h?c:h+"."+c+"."+$;f.push(x)}}else if(a[c][$]==t){let m=""==h?c:h+"."+c+"."+$;f.push(m)}}else for(let b=0;b<a[c].length;b++)if("object"==typeof a[c][b]){let k=""==h?c+"."+b:h+"."+c+"."+b;this.searchValue(t,e,a[c][b],f,k,"internal")}}else if("object"==typeof a[c]){let _=""==h?c:h+"."+c;this.searchValue(t,e,a[c],f,_,"internal")}}let A={};if(A[t]=f,this.stack&&Array.isArray(this.stack)&&"internal"!=n){let j={method:"searchValue",path:void 0,value:""};void 0!=this.options.context&&(j.context="function"==typeof this.options.context?this.options.context({method:"searchValue",value:A}):this.options.context),this.stack.push(j)}return A}subSom(t,e,i,s,o){e=!!e&&e;let n=this.get(t,this.defaultvalue,{origin:"internal"});if(n==this.defaultvalue&&!1==e?(n={},Array.isArray(t)?this.assign(t[0],n):this.assign(t,n)):n==this.defaultvalue&&!0==e&&(n={}),"object"==typeof n){let a=new this.constructor(n,{dv:this.defaultvalue,deepcopy:e,stack:i,context:s});if(this.stack&&Array.isArray(this.stack)&&"internal"!=o){let h={method:"subSom",path:t};void 0!=this.options.context&&(h.context="function"==typeof this.options.context?this.options.context({method:"subSom",value:a}):this.options.context),this.stack.push(h)}return a}if(this.stack&&Array.isArray(this.stack)&&"internal"!=o){let f={method:"subSom",path:t};void 0!=this.options.context&&(f.context="function"==typeof this.options.context?this.options.context({method:"subSom",value:void 0}):this.options.context),this.stack.push(f)}}getSubNodes(t,e){e=!!e&&e;let i=this.subSom(t,e,!1,void 0,"internal"),s=Object.fromEntries(Object.keys(i.data).map(t=>[t,i.subSom(t,e,!1,void 0,"internal")]));if(this.stack&&Array.isArray(this.stack)){let o={method:"getSubNodes",path:t};void 0!=this.options.context&&(o.context="function"==typeof this.options.context?this.options.context({method:"getSubNodes",value:s}):this.options.context),this.stack.push(o)}return s}modify(t,e){if(this.assign(Array.isArray(t)?t[0]:t,e(this.get(t,void 0,{origin:"modify"}))),this.stack&&Array.isArray(this.stack)){let i={method:"modify",path:t};void 0!=this.options.context&&(i.context="function"==typeof this.options.context?this.options.context({method:"modify",value:e(this.get(t,void 0,{origin:"modify"}))}):this.options.context),this.stack.push(i)}}clear(){if(this.stack&&Array.isArray(this.stack)){let t={method:"clear",path:void 0};void 0!=this.options.context&&(t.context="function"==typeof this.options.context?this.options.context({method:"clear",value:void 0}):this.options.context),this.stack.push(t)}this.data={}}}module.exports=Som;