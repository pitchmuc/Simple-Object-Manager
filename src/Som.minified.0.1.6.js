"use strict";class Som{constructor(t,e={dv:void 0,deepcopy:!0,stack:!1,context:void 0}){function i(){let t=new WeakSet;return(e,i)=>{if("object"==typeof i&&null!==i){if(t.has(i))return;t.add(i)}return i}}if(this.data={},this.deepcopy=void 0==e.deepcopy||e.deepcopy,this.defaultvalue="string"==typeof arguments[1]?arguments[1]:e.dv,e.stack&&(this.stack=[],this.options={context:e.context}),"object"==typeof t&&t instanceof Som==!1){if(Array.isArray(t)&&t.length>0){let s=this.data;if("object"==typeof t[0]){let o=this;t.forEach(function(t){if(o.deepcopy)try{s=Object.assign(s,JSON.parse(JSON.stringify(t)))}catch(e){console.warn("issue assigning object, trying removing circular references."),s=Object.assign(s,JSON.parse(JSON.stringify(t,i())))}else s=Object.assign(s,t)})}else this.deepcopy?this.data=JSON.parse(JSON.stringify(t)):this.data=t}else try{this.deepcopy&&!1!=arguments[2]?this.data=JSON.parse(JSON.stringify(t)):this.data=t}catch(n){console.warn("issue assigning object, trying removing circular references."),this.data=Object.assign({},JSON.parse(JSON.stringify(t,i())))}}else if("object"==typeof t&&t instanceof Som==!0)try{this.deepcopy?this.data=Object.assign({},JSON.parse(JSON.stringify(t.data))):this.data=t.data}catch(a){console.warn("issue assigning object, trying removing circular references."),this.data=Object.assign({},JSON.parse(JSON.stringify(t.data,i())))}}get(t,e,i){if(void 0===t||""==t){if(this.stack&&Array.isArray(this.stack)&&"internal"!=i){let s={method:"get",path:t};void 0!=this.options.context&&(s.context="function"==typeof this.options.context?this.options.context({method:"get",value:this.data}):this.options.context),this.stack.push(s)}return this.data}let o=[];Array.isArray(t)?o=t:o.push(t);let n={};for(let a of o)n[a]={pathSplit:"",value:void 0};for(let h of o)if("string"==typeof h){n[h].pathSplit=h.split(".");let r=this.data,c=h.split(".");for(var p=0;p<c.length&&void 0!=r;p++)r=Array.isArray(r)&&Math.abs(parseInt(c[p]))<=r.length?0>parseInt(c[p])?r[r.length-Math.abs(parseInt(c[p]))]:r[parseInt(c[p])]:Array.isArray(r)&&Math.abs(parseInt(c[p]))>r.length?e||this.defaultvalue||void 0:r[c[p]];(""===r||void 0===r&&""==e)&&(n[h].value=""),n[h].value=r}let l="";for(let f in n)l=l||n[f].value;if(void 0===l&&""==e||""==l){if(this.stack&&Array.isArray(this.stack)&&"internal"!=i){let d={method:"get",path:t};void 0!=this.options.context&&(d.context="function"==typeof this.options.context?this.options.context({method:"get",value:""}):this.options.context),this.stack.push(d)}return""}{let u=l||e||this.defaultvalue||void 0;if(this.stack&&Array.isArray(this.stack)&&"internal"!=i){let y={method:"get",path:t};void 0!=this.options.context&&(y.context="function"==typeof this.options.context?this.options.context({method:"get",value:u}):this.options.context),this.stack.push(y)}return u}}assign(t,e,i,s){if(this.stack&&Array.isArray(this.stack)&&"internal"!=s&&"override"!=s){let o={method:"assign",path:t};o.method,void 0!=this.options.context&&(o.context="function"==typeof this.options.context?this.options.context({method:"assign",value:e}):this.options.context),this.stack.push(o)}void 0===e&&(e=i||this.defaultvalue);let n="override"==arguments[3];if(void 0!==t&&""!=t&&"string"==typeof t){for(var a=t.split("."),h=this.data,r=0;r<a.length&&void 0!=h;r++)if("["!=a[r][0]&&"]"!=a[r][a[r].length-1]){if(Object(h).hasOwnProperty(a[r]))r==a.length-1?Array.isArray(h[a[r]])?n?h[a[r]]=e:h[a[r]].push(e):h[a[r]]=e:("string"==typeof h[a[r]]&&(h[a[r]]={}),h=h[a[r]]);else if(r==a.length-1){if("object"!=typeof h)return;h[a[r]]=e}else"["!=a[r+1][0]&&"]"!=a[r][a[r+1].length-1]?h[a[r]]={}:h[a[r]]=[],h=h[a[r]]}else if("["==a[r][0]&&"]"==a[r][a[r].length-1]){let c=a[r].slice(1,a[r].length-1);console.log(c),Array.isArray(h)&&Math.abs(c)<h.length?r==a.length-1?h[c]=e:h=h[c]:Array.isArray(h)&&c>=h.length&&(r==a.length-1?h.push(e):(h.push({}),h=h[h.length-1]))}}else"object"==typeof t&&(this.data=Object.assign(this.data,t));return this.data}merge(t,e){if("object"==typeof t&&void 0===e)e=t,t=void 0;else if("string"==typeof t&&"object"==typeof e);else if("object"==typeof t&&"string"==typeof e){let i=t;t=e,e=i}if(this.stack&&Array.isArray(this.stack)){let s={method:"merge",path:t};void 0!=this.options.context&&(s.context="function"==typeof this.options.context?this.options.context({method:"merge",value:e}):this.options.context),this.stack.push(s)}if(void 0===t||""==t)return this.data=Object.assign(this.data,JSON.parse(JSON.stringify(e))),this.data;{let o=t.split("."),n=this.data;for(var a=0;a<o.length&&void 0!=n;a++)n=Array.isArray(n)&&Math.abs(parseInt(o[a]))<=n.length?0>parseInt(o[a])?n[n.length-Math.abs(parseInt(o[a]))]:n[parseInt(o[a])]:Array.isArray(n)&&Math.abs(parseInt(o[a]))>n.length?this.defaultvalue||void 0:n[o[a]];if(void 0===n&&n==this.defaultvalue)return this.assign(t,e,void 0,"internal"),this.data;if(Array.isArray(n)&&Array.isArray(e))e.forEach(function(t){n.push(t)});else{var h=Object.assign(n,JSON.parse(JSON.stringify(e)));this.data=this.assign(t,h,void 0,"internal")}return this.data}}remove(t,e){if(this.stack&&Array.isArray(this.stack)&&"internal"!=origin){let i={method:"remove",path:t};void 0!=this.options.context&&(i.context="function"==typeof this.options.context?this.options.context({method:"remove",value:void 0}):this.options.context),this.stack.push(i)}if(void 0===e&&(e=!1),""==t||void 0===t)this.clear();else for(var s=t.split("."),o=this.data,n=0;n<s.length&&void 0!=o;n++)if("string"==typeof s[n]&&!0==isNaN(s[n])){if(!Object(o).hasOwnProperty(s[n]))return this.data;n==s.length-1?"object"==typeof o[s[n]]?delete o[s[n]]:e?delete o[s[n]]:o[s[n]]=void 0:o=o[s[n]]}else if("string"==typeof s[n]&&!1==isNaN(s[n])){if(!(Array.isArray(o)&&Math.abs(s[n])<o.length))return this.data;if(n==s.length-1)return o.splice(s[n],1),this.data;o=o[s[n]]}}push(t,e,i=!1){if(this.stack&&Array.isArray(this.stack)&&"internal"!=origin){let s={method:"push",path:t};void 0!=this.options.context&&(s.context="function"==typeof this.options.context?this.options.context({method:"push",value:e}):this.options.context),this.stack.push(s)}if(""==t||void 0===t)this.data=[this.data],this.data.push(e);else if(t.length>0){let o=this.get(t);void 0===o||i?this.assign(t,[e],void 0,"override"):Array.isArray(o)?o.push(e):("object"==typeof o||"string"==typeof o)&&!1==i&&this.assign(t,[o,e],void 0,"internal")}return this.data}mergeDeep(t,e,i,s){if("string"==typeof t?(e=JSON.parse(JSON.stringify(e)),i=i||this.get(t,void 0,"internal")):"object"==typeof t&&(i=e||this.data,e=JSON.parse(JSON.stringify(t))),"object"!=typeof e)throw Error("expect an object as input");let o=i||this.data;if(this.stack&&Array.isArray(this.stack)&&"internal"!=s){let n={method:"mergeDeep",path:t};void 0!=this.options.context&&(n.context="function"==typeof this.options.context?this.options.context({method:"mergeDeep",value:e}):this.options.context),this.stack.push(n)}for(let a in e)if("object"!=typeof e[a])o[a]=e[a];else if("object"==typeof e[a]){if("object"!=typeof o[a])o[a]=e[a];else if(!1===Array.isArray(e[a])&&!1===Array.isArray(o[a]))this.mergeDeep(e[a],o[a],o[a],"internal");else if(Array.isArray(e[a])&&Array.isArray(o[a]))for(let h=0;h<Math.max(e[a].length,o[a].length);h++)void 0===e[a][h]||(void 0===o[a][h]?o[a][h]=e[a][h]:"object"!=typeof e[a][h]?-1==o[a].indexOf(e[a][h])&&o[a].push(e[a][h]):this.mergeDeep(e[a][h],o[a][h],o[a][h],"internal"))}}replace(t,e,i=!1,s,o){if(this.stack&&Array.isArray(this.stack)&&"internal"!=o){let n={method:"replace"};void 0!=this.options.context&&(n.context="function"==typeof this.options.context?this.options.context({method:"replace",value:t,new_value:e}):this.options.context),this.stack.push(n)}let a=s||this.data,h;if(i&&(h=RegExp(t)),"object"==typeof a){for(let r in a)if("object"!=typeof a[r])i?h.test(a[r])&&(a[r]=e):a[r]==t&&(a[r]=e);else if("object"==typeof a[r]){if(Array.isArray(a[r])){let c=this,p=!1;a[r].length>0&&(p="string"==typeof a[r][0]||"number"==typeof a[r][0]);let l=a[r].indexOf(t);if(-1!=l&&(a[r][l]=e),i&&p)for(l=0;l<a[r].length;l++)h.test(a[r][l])&&(a[r][l]=e);else a[r].forEach(function(s){"object"==typeof s&&c.replace(t,e,i,s,"internal")})}else{if(void 0==a[r]||void 0===a[r]||a[r]instanceof Som)break;this.replace(t,e,i,a[r],"internal")}}}}searchValue(t,e=!1,i,s,o,n){let a=i||this.data,h=void 0==o?"":o,r=void 0==s?[]:s,c;if(e&&(c=RegExp(t)),"object"==typeof a){for(let p in a)if("object"!=typeof a[p]){if(e){if(c.test(a[p])){let l=""==h?p:h+"."+p;r.push(l)}}else if(a[p]==t){let f=""==h?p:h+"."+p;r.push(f)}}else if(Array.isArray(a[p])){let d=!1;if(a[p].length>0&&(d="string"==typeof a[p][0]||"number"==typeof a[p][0]),d){for(let u=0;u<a[p].length;u++)if(e){if(c.test(a[p][u])){let y=""==h?p:h+"."+p+"."+u;r.push(y)}}else if(a[p][u]==t){let g=""==h?p:h+"."+p+"."+u;r.push(g)}}else for(let v=0;v<a[p].length;v++)if("object"==typeof a[p][v]){let $=""==h?p+"."+v:h+"."+p+"."+v;this.searchValue(t,e,a[p][v],r,$,"internal")}}else if("object"==typeof a[p]){let x=""==h?p:h+"."+p;this.searchValue(t,e,a[p],r,x,"internal")}}let m={};if(m[t]=r,this.stack&&Array.isArray(this.stack)&&"internal"!=n){let b={method:"searchValue",path:void 0,value:""};void 0!=this.options.context&&(b.context="function"==typeof this.options.context?this.options.context({method:"searchValue",value:m}):this.options.context),this.stack.push(b)}return m}subSom(t,e,i,s){let o=this.get(t,this.defaultvalue,"internal");if(o==this.defaultvalue&&(o={},this.assign(t,o)),"object"==typeof o){let n=new this.constructor(o,{dv:this.defaultvalue,deepcopy:!1,stack:e,context:i});if(this.stack&&Array.isArray(this.stack)&&"internal"!=s){let a={method:"subSom",path:t};void 0!=this.options.context&&(a.context="function"==typeof this.options.context?this.options.context({method:"subSom",value:n}):this.options.context),this.stack.push(a)}return n}if(this.stack&&Array.isArray(this.stack)&&"internal"!=s){let h={method:"subSom",path:t};void 0!=this.options.context&&(h.context="function"==typeof this.options.context?this.options.context({method:"subSom",value:void 0}):this.options.context),this.stack.push(h)}}getSubNodes(t){let e=this.subSom(t,!1,void 0,"internal"),i=Object.fromEntries(Object.keys(e.data).map(t=>[t,e.subSom(t,!1,void 0,"internal")]));if(this.stack&&Array.isArray(this.stack)){let s={method:"getSubNodes",path:t};void 0!=this.options.context&&(s.context="function"==typeof this.options.context?this.options.context({method:"getSubNodes",value:i}):this.options.context),this.stack.push(s)}return i}modify(t,e){if(this.assign(Array.isArray(t)?t[0]:t,e(this.get(t,void 0,"modify"))),this.stack&&Array.isArray(this.stack)){let i={method:"modify",path:t};void 0!=this.options.context&&(i.context="function"==typeof this.options.context?this.options.context({method:"modify",value:e(this.get(t,void 0,"modify"))}):this.options.context),this.stack.push(i)}}clear(){if(this.stack&&Array.isArray(this.stack)){let t={method:"clear",path:void 0};void 0!=this.options.context&&(t.context="function"==typeof this.options.context?this.options.context({method:"clear",value:void 0}):this.options.context),this.stack.push(t)}this.data={}}}module.exports=Som;