"use strict";class Som{constructor(t,e={dv:void 0,deepcopy:!0,stack:!1,context:void 0}){function i(){let t=new WeakSet;return(e,i)=>{if("object"==typeof i&&null!==i){if(t.has(i))return;t.add(i)}return i}}if(this.data={},this.deepcopy=void 0==e.deepcopy||e.deepcopy,this.defaultvalue="string"==typeof arguments[1]?arguments[1]:e.dv,e.stack&&(this.stack=[],this.options={context:e.context}),"object"==typeof t&&t instanceof Som==!1){if(Array.isArray(t)&&t.length>0){let s=this.data;if("object"==typeof t[0]){let o=this;t.forEach(function(t){if(o.deepcopy)try{s=Object.assign(s,JSON.parse(JSON.stringify(t)))}catch(e){console.warn("issue assigning object, trying removing circular references."),s=Object.assign(s,JSON.parse(JSON.stringify(t,i())))}else s=Object.assign(s,t)})}else this.deepcopy?this.data=JSON.parse(JSON.stringify(t)):this.data=t}else try{this.deepcopy&&!1!=arguments[2]?this.data=JSON.parse(JSON.stringify(t)):this.data=t}catch(n){console.warn("issue assigning object, trying removing circular references."),this.data=Object.assign({},JSON.parse(JSON.stringify(t,i())))}}else if("object"==typeof t&&t instanceof Som==!0)try{this.deepcopy?this.data=Object.assign({},JSON.parse(JSON.stringify(t.data))):this.data=t.data}catch(a){console.warn("issue assigning object, trying removing circular references."),this.data=Object.assign({},JSON.parse(JSON.stringify(t.data,i())))}}get(t,e,i){if(this.stack&&Array.isArray(this.stack)&&"internal"!=i){let s={method:"get",path:t};void 0!=this.options.context&&(s.context="function"==typeof this.options.context?this.options.context():this.options.context),this.stack.push(s)}if(void 0===t||""==t)return this.data;let o=[];Array.isArray(t)?o=t:o.push(t);let n={};for(let a of o)n[a]={pathSplit:"",value:void 0};for(let r of o)if("string"==typeof r){n[r].pathSplit=r.split(".");let h=this.data,c=r.split(".");for(var f=0;f<c.length&&void 0!=h;f++)h=Array.isArray(h)&&Math.abs(parseInt(c[f]))<=h.length?0>parseInt(c[f])?h[h.length-Math.abs(parseInt(c[f]))]:h[parseInt(c[f])]:Array.isArray(h)&&Math.abs(parseInt(c[f]))>h.length?e||this.defaultvalue||void 0:h[c[f]];(""===h||void 0===h&&""==e)&&(n[r].value=""),n[r].value=h}let p="";for(let l in n)p=p||n[l].value;return void 0===p&&""==e||""==p?"":p||e||this.defaultvalue||void 0}assign(t,e,i,s){if(this.stack&&Array.isArray(this.stack)&&"internal"!=s&&"override"!=s){let o={method:"assign",path:t};void 0!=this.options.context&&(o.context="function"==typeof this.options.context?this.options.context():this.options.context),this.stack.push(o)}void 0===e&&(e=i||this.defaultvalue);let n="override"==arguments[3];if(void 0!==t&&""!=t&&"string"==typeof t)for(var a=t.split("."),r=this.data,h=0;h<a.length&&void 0!=r;h++)if("string"==typeof a[h]&&!0==isNaN(a[h])){if(Object(r).hasOwnProperty(a[h]))h==a.length-1?Array.isArray(r[a[h]])?n?r[a[h]]=e:r[a[h]].push(e):r[a[h]]=e:("string"==typeof r[a[h]]&&(r[a[h]]={}),r=r[a[h]]);else if(h==a.length-1){if("object"!=typeof r)return;r[a[h]]=e}else isNaN(a[h+1])?r[a[h]]={}:r[a[h]]=[],r=r[a[h]]}else"string"==typeof a[h]&&!1==isNaN(a[h])&&(Array.isArray(r)&&Math.abs(a[h])<r.length?h==a.length-1?r[a[h]]=e:r=r[a[h]]:Array.isArray(r)&&a[h]>=r.length&&(h==a.length-1?r.push(e):(r.push({}),r=r[r.length-1])));else"object"==typeof t&&(this.data=Object.assign(this.data,t));return this.data}merge(t,e){if(this.stack&&Array.isArray(this.stack)&&"internal"!=origin){let i={method:"merge",path:t};void 0!=this.options.context&&(i.context="function"==typeof this.options.context?this.options.context():this.options.context),this.stack.push(i)}if("object"==typeof t&&void 0===e)e=t,t=void 0;else if("string"==typeof t&&"object"==typeof e);else if("object"==typeof t&&"string"==typeof e){let s=t;t=e,e=s}if(void 0===t||""==t)return this.data=Object.assign(this.data,JSON.parse(JSON.stringify(e))),this.data;for(var o=t.split("."),n=this.data,a=0;a<o.length&&void 0!=n;a++)n=Array.isArray(n)&&Math.abs(parseInt(o[a]))<=n.length?0>parseInt(o[a])?n[n.length-Math.abs(parseInt(o[a]))]:n[parseInt(o[a])]:Array.isArray(n)&&Math.abs(parseInt(o[a]))>n.length?this.defaultvalue||void 0:n[o[a]];if(void 0===n&&n==this.defaultvalue)return this.assign(t,e,void 0,"internal"),this.data;if(Array.isArray(n)&&Array.isArray(e))e.forEach(function(t){n.push(t)});else{var r=Object.assign(n,JSON.parse(JSON.stringify(e)));this.data=this.assign(t,r,void 0,"internal")}return this.data}remove(t,e){if(this.stack&&Array.isArray(this.stack)&&"internal"!=origin){let i={method:"remove",path:t};void 0!=this.options.context&&(i.context="function"==typeof this.options.context?this.options.context():this.options.context),this.stack.push(i)}if(void 0===e&&(e=!1),""==t||void 0===t)this.clear();else for(var s=t.split("."),o=this.data,n=0;n<s.length&&void 0!=o;n++)if("string"==typeof s[n]&&!0==isNaN(s[n])){if(!Object(o).hasOwnProperty(s[n]))return this.data;n==s.length-1?"object"==typeof o[s[n]]?delete o[s[n]]:e?delete o[s[n]]:o[s[n]]=void 0:o=o[s[n]]}else if("string"==typeof s[n]&&!1==isNaN(s[n])){if(!(Array.isArray(o)&&Math.abs(s[n])<o.length))return this.data;if(n==s.length-1)return o.splice(s[n],1),this.data;o=o[s[n]]}}push(t,e,i=!1){if(this.stack&&Array.isArray(this.stack)&&"internal"!=origin){let s={method:"push",path:t};void 0!=this.options.context&&(s.context="function"==typeof this.options.context?this.options.context():this.options.context),this.stack.push(s)}if(""==t||void 0===t)this.data=[this.data],this.data.push(e);else if(t.length>0){let o=this.get(t);void 0===o||i?this.assign(t,[e],void 0,"override"):Array.isArray(o)?o.push(e):("object"==typeof o||"string"==typeof o)&&!1==i&&this.assign(t,[o,e],void 0,"internal")}return this.data}mergeDeep(t,e,i,s){if(this.stack&&Array.isArray(this.stack)&&"internal"!=s){let o={method:"mergeDeep",path:t};void 0!=this.options.context&&(o.context="function"==typeof this.options.context?this.options.context():this.options.context),this.stack.push(o)}if("string"==typeof t?i=i||this.get(t,void 0,"internal"):"object"==typeof t&&(i=e||this.data,e=t),"object"!=typeof e)throw Error("expect an object as input");let n=i||this.data;for(let a in e)if("object"!=typeof e[a])n[a]=e[a];else if("object"==typeof e[a]){if("object"!=typeof n[a])n[a]=e[a];else if(!1===Array.isArray(e[a])&&!1===Array.isArray(n[a]))this.mergeDeep(e[a],n[a],n[a],"internal");else if(Array.isArray(e[a])&&Array.isArray(n[a]))for(let r=0;r<Math.max(e[a].length,n[a].length);r++)void 0===e[a][r]||(void 0===n[a][r]?n[a][r]=e[a][r]:"object"!=typeof e[a][r]?-1==n[a].indexOf(e[a][r])&&n[a].push(e[a][r]):this.mergeDeep(e[a][r],n[a][r],n[a][r],"internal"))}}replace(t,e,i=!1,s,o){if(this.stack&&Array.isArray(this.stack)&&"internal"!=o){let n={method:"replace",path:path};void 0!=this.options.context&&(n.context="function"==typeof this.options.context?this.options.context():this.options.context),this.stack.push(n)}let a=s||this.data,r;if(i&&(r=RegExp(t)),"object"==typeof a){for(let h in a)if("object"!=typeof a[h])i?r.test(a[h])&&(a[h]=e):a[h]==t&&(a[h]=e);else if("object"==typeof a[h]){if(Array.isArray(a[h])){let c=this,f=!1;a[h].length>0&&(f="string"==typeof a[h][0]||"number"==typeof a[h][0]);let p=a[h].indexOf(t);if(-1!=p&&(a[h][p]=e),i&&f)for(p=0;p<a[h].length;p++)r.test(a[h][p])&&(a[h][p]=e);else a[h].forEach(function(s){"object"==typeof s&&c.replace(t,e,i,s,"internal")})}else{if(void 0==a[h]||void 0===a[h]||a[h]instanceof Som)break;this.replace(t,e,i,a[h],"internal")}}}}searchValue(t,e=!1,i,s,o,n){if(this.stack&&Array.isArray(this.stack)&&"internal"!=n){let a={method:"search",path:"",value:t};void 0!=this.options.context&&(a.context="function"==typeof this.options.context?this.options.context():this.options.context),this.stack.push(a)}let r=i||this.data,h=void 0==o?"":o,c=void 0==s?[]:s,f;if(e&&(f=RegExp(t)),"object"==typeof r){for(let p in r)if("object"!=typeof r[p]){if(e){if(f.test(r[p])){let l=""==h?p:h+"."+p;c.push(l)}}else if(r[p]==t){let d=""==h?p:h+"."+p;c.push(d)}}else if(Array.isArray(r[p])){let y=!1;if(r[p].length>0&&(y="string"==typeof r[p][0]||"number"==typeof r[p][0]),y){for(let g=0;g<r[p].length;g++)if(e){if(f.test(r[p][g])){let u=""==h?p:h+"."+p+"."+g;c.push(u)}}else if(r[p][g]==t){let v=""==h?p:h+"."+p+"."+g;c.push(v)}}else for(let $=0;$<r[p].length;$++)if("object"==typeof r[p][$]){let x=""==h?p+"."+$:h+"."+p+"."+$;this.searchValue(t,e,r[p][$],c,x,"internal")}}else if("object"==typeof r[p]){let b=""==h?p:h+"."+p;this.searchValue(t,e,r[p],c,b,"internal")}}return(i={})[t]=c,i}subSom(t,e,i){let s=this.get(t);if(s==this.defaultvalue&&(s={},this.assign(t,s)),"object"==typeof s)return new this.constructor(s,{dv:this.defaultvalue,deepcopy:!1,stack:e,context:i})}getSubNodes(t){let e=this.subSom(t);return Object.fromEntries(Object.keys(e.data).map(t=>[t,e.subSom(t)]))}modify(t,e){this.assign(Array.isArray(t)?t[0]:t,e(this.get(t)))}clear(){if(this.stack&&Array.isArray(this.stack)){let t={method:"clear",path:void 0};void 0!=this.options.context&&(t.context="function"==typeof this.options.context?this.options.context():this.options.context),this.stack.push(t)}this.data={}}}