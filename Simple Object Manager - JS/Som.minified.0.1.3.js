"use strict";class Som{constructor(t,i={dv:void 0,deepcopy:!0,stack:!1,context:void 0}){function e(){let t=new WeakSet;return(i,e)=>{if("object"==typeof e&&null!==e){if(t.has(e))return;t.add(e)}return e}}if(this.data={},this.defaultvalue="string"==typeof arguments[1]?arguments[1]:i.dv,i.stack&&(this.stack=[],this.options={context:i.context}),"object"==typeof t&&t instanceof Som==!1){if(Array.isArray(t)&&t.length>0){let s=this.data;t.forEach(function(t){if(i.deepcopy)try{s=Object.assign(s,JSON.parse(JSON.stringify(t)))}catch(o){console.warn("issue assigning object, trying removing circular references."),s=Object.assign(s,JSON.parse(JSON.stringify(t,e())))}else s=Object.assign(s,t)})}else try{i.deepcopy&&!1!==arguments[2]?this.data=JSON.parse(JSON.stringify(t)):this.data=t}catch(o){console.warn("issue assigning object, trying removing circular references."),this.data=Object.assign({},JSON.parse(JSON.stringify(t,e())))}}else if("object"==typeof t&&t instanceof Som==!0)try{this.data=Object.assign({},JSON.parse(JSON.stringify(t.data)))}catch(n){console.warn("issue assigning object, trying removing circular references."),this.data=Object.assign({},JSON.parse(JSON.stringify(t.data,e())))}}get(t,i,e){if(this.stack&&Array.isArray(this.stack)&&"internal"!=e){let s={method:"get",path:t};void 0!=this.options.context&&(s.context="function"==typeof this.options.context?this.options.context():this.options.context),this.stack.push(s)}if(void 0===t||""==t)return this.data;let o=[];Array.isArray(t)?o=t:o.push(t);let n={};for(let a of o)n[a]={pathSplit:"",value:void 0};for(let r of o)if("string"==typeof r){n[r].pathSplit=r.split(".");let h=this.data,c=r.split(".");for(var f=0;f<c.length&&void 0!=h;f++)h=Array.isArray(h)&&Math.abs(parseInt(c[f]))<=h.length?0>parseInt(c[f])?h[h.length-Math.abs(parseInt(c[f]))]:h[parseInt(c[f])]:Array.isArray(h)&&Math.abs(parseInt(c[f]))>h.length?i||this.defaultvalue||void 0:h[c[f]];(""===h||void 0===h&&""==i)&&(n[r].value=""),n[r].value=h}let p="";for(let l in n)p=p||n[l].value;return void 0===p&&""==i||""==p?"":p||i||this.defaultvalue||void 0}assign(t,i,e,s){if(this.stack&&Array.isArray(this.stack)&&"internal"!=s&&"override"!=s){let o={method:"assign",path:t};void 0!=this.options.context&&(o.context="function"==typeof this.options.context?this.options.context():this.options.context),this.stack.push(o)}void 0===i&&(i=e||this.defaultvalue);let n="override"==arguments[3];if(void 0!==t&&""!=t&&"string"==typeof t)for(var a=t.split("."),r=this.data,h=0;h<a.length&&void 0!=r;h++)if("string"==typeof a[h]&&!0==isNaN(a[h])){if(Object(r).hasOwnProperty(a[h]))h==a.length-1?Array.isArray(r[a[h]])?n?r[a[h]]=i:r[a[h]].push(i):r[a[h]]=i:("string"==typeof r[a[h]]&&(r[a[h]]={}),r=r[a[h]]);else if(h==a.length-1){if("object"!=typeof r)return;r[a[h]]=i}else isNaN(a[h+1])?r[a[h]]={}:r[a[h]]=[],r=r[a[h]]}else"string"==typeof a[h]&&!1==isNaN(a[h])&&(Array.isArray(r)&&Math.abs(a[h])<r.length?h==a.length-1?r[a[h]]=i:r=r[a[h]]:Array.isArray(r)&&a[h]>=r.length&&(h==a.length-1?r.push(i):(r.push({}),r=r[r.length-1])));else"object"==typeof t&&(this.data=Object.assign(this.data,t));return this.data}merge(t,i){if(this.stack&&Array.isArray(this.stack)&&"internal"!=origin){let e={method:"merge",path:t};void 0!=this.options.context&&(e.context="function"==typeof this.options.context?this.options.context():this.options.context),this.stack.push(e)}if("object"==typeof t&&void 0===i)i=t,t=void 0;else if("string"==typeof t&&"object"==typeof i);else if("object"==typeof t&&"string"==typeof i){let s=t;t=i,i=s}if(void 0===t||""==t)return this.data=Object.assign(this.data,JSON.parse(JSON.stringify(i))),this.data;for(var o=t.split("."),n=this.data,a=0;a<o.length&&void 0!=n;a++)n=Array.isArray(n)&&Math.abs(parseInt(o[a]))<=n.length?0>parseInt(o[a])?n[n.length-Math.abs(parseInt(o[a]))]:n[parseInt(o[a])]:Array.isArray(n)&&Math.abs(parseInt(o[a]))>n.length?this.defaultvalue||void 0:n[o[a]];if(void 0===n&&n==this.defaultvalue)return this.assign(t,i,void 0,"internal"),this.data;if(Array.isArray(n)&&Array.isArray(i))i.forEach(function(t){n.push(t)});else{var r=Object.assign(n,JSON.parse(JSON.stringify(i)));this.data=this.assign(t,r,void 0,"internal")}return this.data}remove(t,i){if(this.stack&&Array.isArray(this.stack)&&"internal"!=origin){let e={method:"remove",path:t};void 0!=this.options.context&&(e.context="function"==typeof this.options.context?this.options.context():this.options.context),this.stack.push(e)}if(void 0===i&&(i=!1),""==t||void 0===t)this.clear();else for(var s=t.split("."),o=this.data,n=0;n<s.length&&void 0!=o;n++)if("string"==typeof s[n]&&!0==isNaN(s[n])){if(!Object(o).hasOwnProperty(s[n]))return this.data;n==s.length-1?"object"==typeof o[s[n]]?delete o[s[n]]:i?delete o[s[n]]:o[s[n]]=void 0:o=o[s[n]]}else if("string"==typeof s[n]&&!1==isNaN(s[n])){if(!(Array.isArray(o)&&Math.abs(s[n])<o.length))return this.data;if(n==s.length-1)return o.splice(s[n],1),this.data;o=o[s[n]]}}push(t,i,e=!1){if(this.stack&&Array.isArray(this.stack)&&"internal"!=origin){let s={method:"push",path:t};void 0!=this.options.context&&(s.context="function"==typeof this.options.context?this.options.context():this.options.context),this.stack.push(s)}if(""==t||void 0===t)this.data=[this.data],this.data.push(i);else if(t.length>0){let o=this.get(t);void 0===o||e?this.assign(t,[i],void 0,"override"):Array.isArray(o)?o.push(i):("object"==typeof o||"string"==typeof o)&&!1==e&&this.assign(t,[o,i],void 0,"internal")}return this.data}mergeDeep(t,i,e,s){if(this.stack&&Array.isArray(this.stack)&&"internal"!=s){let o={method:"mergeDeep",path:t};void 0!=this.options.context&&(o.context="function"==typeof this.options.context?this.options.context():this.options.context),this.stack.push(o)}if("string"==typeof t?e=e||this.get(t,void 0,"internal"):"object"==typeof t&&(e=i||this.data,i=t),"object"!=typeof i)throw Error("expect an object as input");let n=e||this.data;for(let a in i)if("object"!=typeof i[a])n[a]=i[a];else if("object"==typeof i[a]){if("object"!=typeof n[a])n[a]=i[a];else if(!1===Array.isArray(i[a])&&!1===Array.isArray(n[a]))this.mergeDeep(i[a],n[a],n[a],"internal");else if(Array.isArray(i[a])&&Array.isArray(n[a]))for(let r=0;r<Math.max(i[a].length,n[a].length);r++)void 0===i[a][r]||(void 0===n[a][r]?n[a][r]=i[a][r]:"object"!=typeof i[a][r]?-1==n[a].indexOf(i[a][r])&&n[a].push(i[a][r]):this.mergeDeep(i[a][r],n[a][r],n[a][r],"internal"))}}replace(t,i,e=!1,s,o){if(this.stack&&Array.isArray(this.stack)&&"internal"!=o){let n={method:"replace",path:path};void 0!=this.options.context&&(n.context="function"==typeof this.options.context?this.options.context():this.options.context),this.stack.push(n)}let a=s||this.data,r;if(e&&(r=RegExp(t)),"object"==typeof a){for(let h in a)if("object"!=typeof a[h])e?r.test(a[h])&&(a[h]=i):a[h]==t&&(a[h]=i);else if("object"==typeof a[h]){if(Array.isArray(a[h])){let c=this,f=!1;a[h].length>0&&(f="string"==typeof a[h][0]||"number"==typeof a[h][0]);let p=a[h].indexOf(t);if(-1!=p&&(a[h][p]=i),e&&f)for(p=0;p<a[h].length;p++)r.test(a[h][p])&&(a[h][p]=i);else a[h].forEach(function(s){"object"==typeof s&&c.replace(t,i,e,s,"internal")})}else{if(void 0==a[h]||void 0===a[h]||a[h]instanceof Som)break;this.replace(t,i,e,a[h],"internal")}}}}clear(){if(this.stack&&Array.isArray(this.stack)){let t={method:"clear",path:void 0};void 0!=this.options.context&&(t.context="function"==typeof this.options.context?this.options.context():this.options.context),this.stack.push(t)}this.data={}}}